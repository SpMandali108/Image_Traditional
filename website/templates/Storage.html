{% extends 'base.html' %}
{% block logo_link %}
<a href="/navaratri_admin" class="logo">
    <img src="{{ url_for('static', filename='favicon.png') }}" alt="Image Traditional Logo">
    <span class="logo-text">Image Traditional</span>
</a>
{% endblock %}

{% block content %}

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/css/select2.min.css" rel="stylesheet" />

<style>
  /* Override base.html body styles for this page */
  body {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%) !important;
    min-height: 100vh;
  }

  body.dark-theme {
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%) !important;
  }

  :root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    
    /* Light mode colors */
    --card-bg: rgba(255, 255, 255, 0.95);
    --card-hover-shadow: rgba(0, 0, 0, 0.12);
    --card-shadow: rgba(0, 0, 0, 0.08);
    --input-bg: white;
    --input-border: #e8ecf1;
    --checkbox-bg: #f8fafc;
    --checkbox-border: #e8ecf1;
    --text-color: #4a5568;
    --list-hover-bg: #f8fafc;
    --scroll-track: #f1f5f9;
    --scroll-thumb: #cbd5e1;
    --scroll-thumb-hover: #94a3b8;
    --result-bg: #f8fafc;
  }

  body.dark-theme {
    /* Dark mode colors */
    --card-bg: rgba(45, 55, 72, 0.95);
    --card-hover-shadow: rgba(0, 0, 0, 0.3);
    --card-shadow: rgba(0, 0, 0, 0.2);
    --input-bg: #2d3748;
    --input-border: #4a5568;
    --checkbox-bg: #2d3748;
    --checkbox-border: #4a5568;
    --text-color: #e2e8f0;
    --list-hover-bg: #374151;
    --scroll-track: #2d3748;
    --scroll-thumb: #4a5568;
    --scroll-thumb-hover: #718096;
    --result-bg: #374151;
  }

  .main-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .page-title {
    font-size: 2.5rem;
    font-weight: 800;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-align: center;
    margin-bottom: 3rem;
    letter-spacing: -0.5px;
  }

  .modern-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: none;
    border-radius: 20px;
    box-shadow: 0 10px 40px var(--card-shadow);
    margin-bottom: 2rem;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
  }

  .modern-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 50px var(--card-hover-shadow);
  }

  .card-header-modern {
    background: var(--primary-gradient);
    color: white;
    padding: 1.5rem;
    font-weight: 600;
    font-size: 1.2rem;
    border: none;
  }

  .card-body-modern {
    padding: 2rem;
  }

  .form-control, .form-select {
    border: 2px solid #e8ecf1;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    transition: all 0.3s ease;
    background: white;
  }

  .form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    background: white;
  }

  .btn-modern {
    border-radius: 12px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border: none;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.9rem;
  }

  .btn-primary-modern {
    background: var(--primary-gradient);
    color: white;
  }

  .btn-primary-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
  }

  .btn-success-modern {
    background: var(--success-gradient);
    color: white;
  }

  .btn-success-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(17, 153, 142, 0.3);
  }

  .btn-info-modern {
    background: var(--info-gradient);
    color: white;
  }

  .btn-info-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
  }

  .btn-warning-modern {
    background: var(--warning-gradient);
    color: white;
  }

  .btn-warning-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(250, 112, 154, 0.3);
  }

  .form-label {
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  .checkbox-container {
    background: #f8fafc;
    border: 2px solid #e8ecf1;
    border-radius: 12px;
    padding: 1rem;
    height: 220px;
    overflow-y: auto;
  }

  .checkbox-container::-webkit-scrollbar {
    width: 8px;
  }

  .checkbox-container::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 10px;
  }

  .checkbox-container::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 10px;
  }

  .checkbox-container::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  .form-check {
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    transition: background 0.2s ease;
  }

  .form-check:hover {
    background: white;
  }

  .form-check-input {
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid #cbd5e1;
    cursor: pointer;
  }

  .form-check-input:checked {
    background-color: #667eea;
    border-color: #667eea;
  }

  .results-card {
    animation: slideUp 0.5s ease;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .list-group-item {
    border: 2px solid var(--input-border);
    border-radius: 10px !important;
    margin-bottom: 0.5rem;
    padding: 1rem;
    transition: all 0.3s ease;
    background: var(--card-bg);
    color: var(--text-color);
  }

  .list-group-item:hover {
    background: var(--list-hover-bg);
    border-color: #667eea;
    transform: translateX(5px);
  }

  .badge-modern {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 600;
  }

  @media (max-width: 768px) {
    .page-title {
      font-size: 2rem;
    }
    
    .card-body-modern {
      padding: 1.5rem;
    }
  }
</style>

<div class="main-container">

  <h1 class="page-title">Storage Management</h1>

  <!-- ADD BAG FORM -->
  <div class="modern-card">
    <div class="card-header-modern">
      üì¶ Add a New Bag
    </div>
    <div class="card-body-modern">
      <form action="/add_bag" method="POST" class="row g-3">
        <div class="col-md-5">
          <label class="form-label">Bag Name</label>
          <input type="text" name="name" class="form-control" placeholder="Enter bag name" required>
        </div>
        <div class="col-md-5">
          <label class="form-label">Description</label>
          <input type="text" name="bag_description" class="form-control" placeholder="Optional description">
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-modern btn-primary-modern w-100">Add Bag</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ADD PRODUCTS -->
  <div class="modern-card">
    <div class="card-header-modern">
      üè∑Ô∏è Add Products to Bag
    </div>
    <div class="card-body-modern">
      <form action="/add_product" method="POST">
        <div class="row g-3">

          <!-- Select Bag -->
          <div class="col-md-12">
            <label class="form-label">Select Bag</label>
            <select name="bag_id" class="form-select" required>
              <option value="">Choose a bag...</option>
              {% for bag in bags %}
                <option value="{{ bag._id }}">{{ bag.name }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- C Codes -->
          <div class="col-md-6">
            <label class="form-label">C Products</label>
            <div class="checkbox-container">
              {% for code in available_codes if code.startswith('C') %}
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="product_codes" value="{{ code }}" id="code_{{ code }}">
                  <label class="form-check-label" for="code_{{ code }}">{{ code }}</label>
                </div>
              {% endfor %}
            </div>
          </div>

          <!-- K Codes -->
          <div class="col-md-6">
            <label class="form-label">K Products</label>
            <div class="checkbox-container">
              {% for code in available_codes if code.startswith('K') %}
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="product_codes" value="{{ code }}" id="code_{{ code }}">
                  <label class="form-check-label" for="code_{{ code }}">{{ code }}</label>
                </div>
              {% endfor %}
            </div>
          </div>

          <!-- Other product button -->
          <div class="col-12 mt-3">
            <button type="button" id="addOtherBtn" class="btn btn-modern btn-warning-modern">
              ‚ûï Add Custom Product
            </button>
          </div>

          <!-- Custom input for other product -->
          <div id="customCodeInput" class="col-md-6" style="display:none;">
            <label class="form-label">Custom Product Code</label>
            <input type="text" name="custom_code" class="form-control" placeholder="Enter product code manually">
          </div>

          <div class="col-12 text-end mt-4">
            <button type="submit" class="btn btn-modern btn-success-modern">
              ‚úì Add Products
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- SEARCH FORM -->
  <div class="modern-card">
    <div class="card-header-modern">
      üîç Search Storage
    </div>
    <div class="card-body-modern">
      <form action="/Storage" method="POST" class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">Search By</label>
          <select name="search_type" class="form-select">
            <option value="product">Product Code</option>
            <option value="bag">Bag Name</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label">Search Query</label>
          <input type="text" name="query" class="form-control" placeholder="Enter code or bag name" required>
        </div>
        <div class="col-md-3">
          <button type="submit" class="btn btn-modern btn-info-modern w-100">Search</button>
        </div>
      </form>
    </div>
  </div>

  <!-- SEARCH RESULTS -->
  {% if result %}
  <div id="results" class="modern-card results-card">
    <div class="card-header-modern">
      üìä Search Results
    </div>
    <div class="card-body-modern">
      {% if result is mapping %}
        <div class="row g-3">
          <div class="col-12">
            <h5 class="mb-3">Product Details</h5>
          </div>
          <div class="col-md-4">
            <div class="p-3 rounded-3" style="background: var(--result-bg);">
              <small class="text-muted d-block mb-1">Product Code</small>
              <strong class="fs-5" style="color: var(--text-color);">{{ result._id }}</strong>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 rounded-3" style="background: var(--result-bg);">
              <small class="text-muted d-block mb-1">Bag Name</small>
              <strong class="fs-5" style="color: var(--text-color);">{{ result.bag_name }}</strong>
            </div>
          </div>
          <div class="col-md-4">
            <div class="p-3 rounded-3" style="background: var(--result-bg);">
              <small class="text-muted d-block mb-1">Description</small>
              <strong class="fs-5" style="color: var(--text-color);">{{ result.bag_description or 'N/A' }}</strong>
            </div>
          </div>
        </div>
      {% elif result is iterable %}
        <h5 class="mb-3">Products in Bag ({{ result|length }} items)</h5>
        <div class="list-group">
          {% for item in result %}
            <div class="list-group-item">
              <strong>{{ item._id }}</strong>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

</div>

<!-- JS: jQuery, Bootstrap, Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function() {
  // Toggle custom code input
  $('#addOtherBtn').on('click', function() {
    $('#customCodeInput').slideToggle(300);
    $('#customCodeInput input').focus();
  });

  // Make entire checkbox div clickable
  $('.form-check').on('click', function(e) {
    // Don't trigger if clicking directly on checkbox or label
    if (e.target.type !== 'checkbox' && !$(e.target).is('label')) {
      var checkbox = $(this).find('.form-check-input');
      checkbox.prop('checked', !checkbox.prop('checked'));
    }
  });

  // Initialize Select2 if needed
  $('.form-select').select2({
    theme: 'bootstrap-5',
    width: '100%'
  });
});

// Smooth scroll to results
window.onload = function() {
  if (document.getElementById('results')) {
    setTimeout(function() {
      document.getElementById('results').scrollIntoView({ 
        behavior: 'smooth',
        block: 'center'
      });
    }, 100);
  }
};
</script>

{% endblock %}